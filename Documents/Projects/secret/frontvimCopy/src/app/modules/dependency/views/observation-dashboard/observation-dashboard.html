<div class="pt-5 pb-5">
  <ngx-spinner 
bdColor="rgba(0,0,0,0.80)" 
size="large" 
color="#fff" 
type="ball-clip-rotate-multiple" 
[fullScreen]="true">
<p style="font-size: 2rem; color: white !important; margin-top:1rem">Procesando...</p>
</ngx-spinner>

  <section>
    <div class="row mt-5">
      <div class="col-sm-12 col-md-8">
        <h1>Solicitudes en observación</h1>
        <h5>{{ token.dependencyName }} {{ token.programName ? ': ' + token.programName : ''}}</h5>
        <app-apoyos-select (emitSelected)="updateSelectedApoyo($event)" [specialSelection]="false"></app-apoyos-select>
      </div>
    </div>
  </section>

  <section>
    <div class="row">
      <div class="col-md-12">
        <hr>
      </div>
    </div>
  </section>

  <section class="row mt-2">
    <div class="col-md-2 col-sm-4" *ngFor="let kpi of kpiList | keyvalue:onCompare">
      <app-mini-kpi [kpiData]="kpi.value" (typeOutput)="onKpiSelect($event)"></app-mini-kpi>
    </div>
  </section>

  <section class="pt-5">
    <div class="row">
      <div class="col-md-4">
        <h5>Filtrar Palabras Clave</h5>
        <div class="d-flex">
          <nz-input-group nzPrefixIcon="search" id="search-request-input">
            <input nz-input type="text" name="filterWord" [(ngModel)]="filterWord" placeholder="Palabras clave" />
          </nz-input-group>
          <button class="btn btn-custom-primary" (click)="onSolicitudFilter()"
            [disabled]="filterWord.length === 0">Buscar</button>
          <button *ngIf="isFiltered" class="btn btn-custom-info" (click)="onClearFilter()">Limpiar</button>
        </div>
      </div>
    </div>
  </section>

  <section>
    <section *ngIf="notData">
      <div class="row mt-5">
        <div class="col-md-12 d-flex justify-content-center">
          <div class="row">
            <div class="d-flex justify-content-center">
              <img class="no-data-icon" src="../../../../../assets/images/iconos/no-data.png" alt="no_data_found">
            </div>
            <h3 class="text-center">No se encontró información</h3>
          </div>
        </div>
      </div>
    </section>
    <ng-container *ngIf="!notData">
      <div class="row">
        <div class="col-sm-12 col-md-6 col-lg-4 mt-4" *ngFor="let card of cardList">
          <app-applicant-card [cardData]="card" (detailsButtonClickEvent)="onApplicantCardClick($event)"
            (ActionsOnFolioEvent)="actionsOnFolioEvent($event)"></app-applicant-card>
        </div>
      </div>
    </ng-container>
    <div class="row">
      <div class="col-md-12 d-flex justify-content-center mt-4 pt-2">
        <nz-pagination (nzPageIndexChange)="onIndexChange($event)" [nzPageSize]="paginator.pagination.pageSize"
          [nzPageIndex]="paginator.pagination.pageIndex" [nzTotal]="paginator.pagination.totalRecords">
        </nz-pagination>
      </div>
    </div>
  </section>
</div>

<nz-modal *ngIf="observationModal" id="request-modal" [nzStyle]="{top: '1rem'}" nzWidth="85%" [nzVisible]="true"
  [nzTitle]="'Observaciones'" (nzOnCancel)="onHideModal()" (nzOnOk)="onHideModal()">
  <ng-container *nzModalContent class="ant-modal-body">
    <div class="row">
      <div class="col-md-12">
        <!-- STANDARD -->
        <ng-container *ngFor="let item of standardDocuments; let i = index">
          <h2>{{ item.nombre }}</h2>
          <section class="row">
            <!-- Document viewer  -->
            <div class="col-md-6 selection-box text-center" *ngIf="fileExists(solicitudStandardDocuments, item.nombre)">
              <iframe *ngIf="getFileUrl(solicitudStandardDocuments, item.nombre)"
                [src]="getFileUrl(solicitudStandardDocuments, item.nombre) | safe: 'resourceUrl'" frameBorder="0"
                scrolling="auto" height="80%" width="100%"></iframe>
            </div>
          </section>
          <!-- Historic list  -->
          <div class="row">
            <div class="col-md-12">
              <!-- Not has comments  -->
              <div class="card-container-true">
                <nz-tabset nzType="card" *ngIf="!item.observaciones">
                  <nz-tab nzTitle="Sin observaciones">
                    <div class="card-container-true-content">
                      <div class="card-container-true-content-comment">
                        <p class="ml-5">Este documento no contiene observaciones</p>
                      </div>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
              <!-- Has comments  -->
              <div
                [ngClass]="{'card-container-false': item.habilitado === false,'card-container-true': item.habilitado === true}">
                <nz-tabset nzType="card" style="height:220px;" [nzTabPosition]="nzTabPosition"
                  [(nzSelectedIndex)]="selectedIndex" (nzSelectChange)="log([$event])" *ngIf="item.observaciones">
                  <nz-tab *ngFor="let tab of item.observaciones | reorderObservations; let i = index"
                    nzTitle="Observación # {{i + 1}}" (nzSelect)="log(['select', tab])" (nzClick)="log(['click', tab])"
                    (nzContextmenu)="log(['contextmenu', tab])" (nzDeselect)="log(['deselect', tab])">
                    <div
                      [ngClass]="{'div-historic-list': item.habilitado === false,'div-historic-list-true': item.habilitado === true}">
                      <p class="div-historic-list-usr">{{tab.usuario | formatNameWithoutRol}}</p>
                      <div class="div-historic-list-comment">
                        <p class="ml-5 pb-2">Usuario de campo: {{captureUser}}</p>
                        <p class="ml-5 pb-2">{{tab.comentario}}</p>
                      </div>
                      <span
                        [ngClass]="{'div-historic-list-date': item.habilitado === false,'div-historic-list-true-date': item.habilitado === true}">
                        <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
                        {{tab.fecha | date: 'medium' : 'GMT'}}
                      </span>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
            </div>
          </div>
          <hr>
        </ng-container>

        <!--  ESPECIFICOS -->
        <ng-container *ngFor="let item of specificDocuments; let i = index">
          <h2>{{ item.nombre }}</h2>

          <article class="row">
            <section *ngIf="fileExists(solicitudProgramDocuments, item.nombre)"
              class="col-md-6 selection-box text-center">
              <iframe *ngIf="getFileUrl(solicitudProgramDocuments, item.nombre)"
                [src]="getFileUrl(solicitudProgramDocuments, item.nombre) | safe: 'resourceUrl'" frameBorder="0"
                scrolling="auto" height="80%" width="100%"></iframe>
            </section>
          </article>
          <!-- Historic list  -->
          <div class="row">
            <div class="col-md-12">
              <!-- Not has comments  -->
              <div class="card-container-true">
                <nz-tabset nzType="card" *ngIf="!item.observaciones">
                  <nz-tab nzTitle="Sin observaciones">
                    <div class="card-container-true-content">
                      <div class="card-container-true-content-comment">
                        <p class="ml-5">Este documento no contiene observaciones</p>
                      </div>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
              <!-- Has comments  -->
              <div
                [ngClass]="{'card-container-false': item.habilitado === false,'card-container-true': item.habilitado === true}">
                <nz-tabset nzType="card" style="height:220px;" [nzTabPosition]="nzTabPosition"
                  [(nzSelectedIndex)]="selectedIndex" (nzSelectChange)="log([$event])" *ngIf="item.observaciones">
                  <nz-tab *ngFor="let tab of item.observaciones; let i = index" nzTitle="Observación # {{i + 1}}"
                    (nzSelect)="log(['select', tab])" (nzClick)="log(['click', tab])"
                    (nzContextmenu)="log(['contextmenu', tab])" (nzDeselect)="log(['deselect', tab])">
                    <div
                      [ngClass]="{'div-historic-list': item.habilitado === false,'div-historic-list-true': item.habilitado === true}">
                      <p class="div-historic-list-usr">{{tab.usuario | formatNameWithoutRol}}</p>
                      <div class="div-historic-list-comment">
                        <p class="ml-5 pb-2">Usuario de campo: {{captureUser}}</p>
                        <p class="ml-5">{{tab.comentario}}</p>
                      </div>
                      <span
                        [ngClass]="{'div-historic-list-date': item.habilitado === false,'div-historic-list-true-date': item.habilitado === true}">
                        <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
                        {{tab.fecha | date: 'medium' : 'GMT'}}
                      </span>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
            </div>
          </div>
          <hr>
        </ng-container>
      </div>
    </div>

  </ng-container>
  <div *nzModalFooter class="">
    <button class="btn btn-vim-outline me-3" (click)="onHideModal()">Cerrar modal</button>
  </div>
</nz-modal>

